---
phase: 01-fix-review-findings
plan: 03
type: execute
depends_on: []
files_modified: []
---

<objective>
Fix critical code review findings from GOO-141, GOO-142, GOO-143

Purpose: Improve security, reliability, and prevent zombie processes
Output: Fixed gsd-executor.js and git-service.js with passing tests
</objective>

<execution_context>
@.goodflows/workflows/execute-plan.md
@.goodflows/templates/summary.md
</execution_context>

<context>
@.goodflows/PROJECT.md
@.goodflows/ROADMAP.md
@.goodflows/STATE.md
</context>

<tasks>

<task type="auto" id="task-1">
  <name>GOO-141: Add process cleanup on verification timeout</name>
  <files>lib/gsd-executor.js</files>
  <action>
    In lib/gsd-executor.js _runVerification method (lines 407-435):
1. Add explicit process.kill(SIGTERM) call when timeout fires
2. Add fallback to SIGKILL after 5 seconds if process still running
3. Clean up event listeners to prevent memory leaks
  </action>
  <verify>npm test</verify>
  <done>Spawned processes are killed on timeout, no zombie processes</done>
</task>

<task type="auto" id="task-2">
  <name>GOO-142: Add subagent result validation</name>
  <files>lib/gsd-executor.js</files>
  <action>
    In lib/gsd-executor.js _executeTaskViaSubagent method (lines 277-299):
1. Create _validateSubagentResult(result) helper function
2. Validate required properties exist: success, files, output
3. Throw descriptive error if validation fails
4. Add default values for optional properties
  </action>
  <verify>npm test</verify>
  <done>Subagent results validated before access, clear errors on malformed data</done>
</task>

<task type="auto" id="task-3">
  <name>GOO-143: Fix TOCTOU race condition in git staging</name>
  <files>lib/git-service.js</files>
  <action>
    In lib/git-service.js stageFiles method (lines 90-120):
1. Remove existsSync() check before staging
2. Let git add handle non-existent files gracefully
3. Catch and handle git errors appropriately
4. Return list of actually staged files
  </action>
  <verify>npm test</verify>
  <done>No TOCTOU vulnerability, git errors handled gracefully</done>
</task>

</tasks>

<verification>
Before declaring complete:
- [ ] Task 1 verification passed
- [ ] Task 2 verification passed
- [ ] Task 3 verification passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
</success_criteria>
