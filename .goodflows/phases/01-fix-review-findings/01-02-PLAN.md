---
phase: 01-fix-review-findings
plan: 02
type: execute
depends_on: []
files_modified: []
---

<objective>
Implement file-based cross-CLI sync for multi-LLM collaboration

Purpose: Enable Claude, Gemini, GPT-4 to share context and work on same codebase
Output: lib/sync-manager.js, CLI commands, MCP tools
</objective>

<execution_context>
@.goodflows/workflows/execute-plan.md
@.goodflows/templates/summary.md
</execution_context>

<context>
@.goodflows/PROJECT.md
@.goodflows/ROADMAP.md
@.goodflows/STATE.md
</context>

<tasks>

<task type="auto" id="task-1">
  <name>Create sync-manager.js core module</name>
  <files>lib/sync-manager.js</files>
  <action>
    Create lib/sync-manager.js with:
1. SyncManager class
2. export() - Export context to .goodflows/sync/handoff-{llm}.json
3. import() - Import from another LLM's handoff file
4. merge() - Merge multiple LLM contexts
5. status() - Show sync status and changes
  </action>
  <verify>npm test -- sync-manager</verify>
  <done>SyncManager class exists with export, import, merge, status methods</done>
</task>

<task type="auto" id="task-2">
  <name>Add CLI sync commands</name>
  <files>bin/cli/sync.js, bin/cli/index.js</files>
  <action>
    Create bin/cli/sync.js with commands:
- goodflows sync export
- goodflows sync import
- goodflows sync status
- goodflows sync merge
  </action>
  <verify>goodflows sync --help</verify>
  <done>CLI commands work and show help</done>
</task>

<task type="checkpoint:human-verify" id="task-3" gate="blocking">
  <what-built>Core sync module and CLI commands</what-built>
  <how-to-verify>
    Run: goodflows sync export && goodflows sync status
  </how-to-verify>
  <resume-signal>Type "approved" to continue</resume-signal>
</task>

<task type="auto" id="task-4">
  <name>Add MCP sync handlers</name>
  <files>bin/mcp/handlers/sync.js, bin/mcp/index.js</files>
  <action>
    Create bin/mcp/handlers/sync.js with tools:
- goodflows_sync_export
- goodflows_sync_import
- goodflows_sync_merge
- goodflows_sync_status
  </action>
  <verify>npm test -- mcp-sync</verify>
  <done>MCP tools registered and callable</done>
</task>

<task type="auto" id="task-5">
  <name>Implement conflict resolution</name>
  <files>lib/sync-manager.js</files>
  <action>
    Add conflict detection and resolution:
1. Detect same file modified by both LLMs
2. Detect conflicting findings
3. Detect session state conflicts
4. Provide merge strategies (theirs, ours, manual)
  </action>
  <verify>npm test -- sync-conflicts</verify>
  <done>Conflicts detected and resolved automatically where possible</done>
</task>

<task type="auto" id="task-6">
  <name>Add role-based context filtering</name>
  <files>lib/sync-manager.js, bin/mcp/handlers/sync.js</files>
  <action>
    Add role parameter to export:
- includeFiles glob patterns
- excludeFiles glob patterns
- role metadata (frontend, backend, etc.)
  </action>
  <verify>npm test -- sync-roles</verify>
  <done>Can export filtered context by role</done>
</task>

</tasks>

<verification>
Before declaring complete:
- [ ] Task 1 verification passed
- [ ] Task 2 verification passed
- [ ] Task 3 verification passed
- [ ] Task 4 verification passed
- [ ] Task 5 verification passed
- [ ] Task 6 verification passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
</success_criteria>
